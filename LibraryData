package Server;

import java.io.*;
import java.util.*;

public class LibraryData {
    private static List<Book> books = new ArrayList<>();
    private static final String BOOK_FILE = "data/books.txt";

    public static List<Book> getBooks() {
        return books;
    }

    // Load sách từ file
    public static void loadBooks() {
        books.clear();
        try (BufferedReader br = new BufferedReader(new FileReader(BOOK_FILE))) {
            String line;
            while ((line = br.readLine()) != null) {
                // Format: id,title,author,totalCopies
                String[] parts = line.split(",", 4);
                if (parts.length >= 4) {
                    books.add(new Book(
                        parts[0].trim(),
                        parts[1].trim(),
                        parts[2].trim(),
                        Integer.parseInt(parts[3].trim())
                    ));
                }
            }
        } catch (IOException e) {
            System.out.println("Không thể load books.txt");
        }
    }

    // Mượn sách (tăng borrowedCopies)
    public static boolean borrowBook(String bookId) {
        for (Book b : books) {
            if (b.getId().equals(bookId) && b.getAvailableCopies() > 0) {
                b.borrow();
                return true;
            }
        }
        return false; // không còn sách hoặc không tồn tại
    }

    // Trả sách (giảm borrowedCopies)
    public static boolean returnBook(String bookId) {
        for (Book b : books) {
            if (b.getId().equals(bookId) && b.getBorrowedCopies() > 0) {
                b.returned();
                return true;
            }
        }
        return false; // không tìm thấy sách hoặc chưa ai mượn
    }

    // Tìm sách theo id
    public static Book findBookById(String bookId) {
        for (Book b : books) {
            if (b.getId().equals(bookId)) return b;
        }
        return null;
    }

    // Hiển thị danh sách sách (chuẩn)
    public static void printBooks() {
        for (Book b : books) {
            System.out.println(b.getId() + " - " + b.getTitle() + " (" + b.getAuthor() + ") "
                    + "| Số lượng còn: " + b.getAvailableCopies() + "/" + b.getTotalCopies());
        }
    }
}
